# Описание проекта: System-Level Simulator & Scheduler

## 1. Общая идея и назначение кода

Код предназначен для имитации (system-level simulation) работы беспроводной сети (примерно LTE/5G), где осуществляется:

### Симулятор (класс `SystemLevelSimulator`), отвечающий за:
- **Расположение базовой станции (gNB) и пользователей (UE).**
- **Моделирование движения пользователей и обновление их координат.**
- **Расчет параметров канала (RSRP, SINR, CQI).**
- **Выдачу информации о состоянии канала и трафика (ChannelInfo) планировщику.**

### Планировщик (класс `CustomScheduler`), который:
- **Принимает данные о канале и трафике (CQI, RSRP, Traffic).**
- **Выполняет распределение ресурсов (ресурсных блоков, RB) между пользователями на восходящей (UL) и нисходящей (DL) линиях.**
- **Поддерживает различные алгоритмы планирования**:
  - RoundRobin
  - ProportionalFair
  - MaxThroughput
  - **(опционально)** ML-алгоритм (CatBoost)
- **Ведет HARQ-процессы, может логировать результаты, собирать данные для обучения и т.д.**

### Главный скрипт (после объявления классов), который:
- Инициализирует симулятор и планировщик.
- Запускает цикл по времени (шаги `simTime`).
- На каждом шаге определяет, идет ли DL или UL слот (через `tddConfig`).
- Вызывает методы планировщика (`scheduleDL` или `scheduleUL`), а затем обновляет визуализацию.

Таким образом, проект демонстрирует базовый каркас системы, где можно экспериментировать с разными алгоритмами планирования, отслеживать показатели канала и визуализировать распределение ресурсных блоков.

## 2. Класс SystemLevelSimulator

### Основные моменты

**Свойства:**
- `NumUEs`: число пользователей.
- `Bandwidth`: полоса частот (Гц).
- `SCS`: Subcarrier Spacing (например, 30 кГц).
- `NumRBs`: количество ресурсных блоков, рассчитываемое как `floor(bw / (12 * scs))`.
- `SimTime`: общее время симуляции.
- `UELocations`: координаты всех пользователей.
- `RSRP`, `SINR`, `CQI_DL`, `CQI_UL`: параметры канала для каждого пользователя.
- `TrafficDL`, `TrafficUL`: данные о трафике, генерируемые по пуассоновскому процессу.
- `gNBLocation`: координаты базовой станции.
- `ChannelInfo`: структура, содержащая RSRP, CQI_DL, CQI_UL и данные трафика для передачи планировщику.
- `MovementStep`: определяет скорость движения пользователей (в метрах).

**Методы:**
- **Конструктор** `SystemLevelSimulator(numUEs, bw, scs, simTime)`:  
  Инициализирует ключевые параметры, вычисляет количество RB, задаёт положение gNB, вызывает `initializeUE()` и `updateChannelConditions()`.
  
- **initializeUE()**:  
  Случайным образом распределяет пользователей в заданной области (например, 500×500 м).

- **initializeMobility()**:  
  Инициализирует целевые точки для каждого пользователя в модели Random Waypoint.

- **updateTraffic()**:  
  Генерирует трафик для DL и UL с использованием пуассоновского распределения.

- **updateNetwork(t)**:  
  Двигает пользователей к целевым точкам, обновляет их положение, трафик и параметры канала.

- **updateChannelConditions()**:  
  Рассчитывает RSRP, SINR и CQI, а также собирает данные в структуру ChannelInfo, включая информацию о трафике.

## 3. Класс CustomScheduler

### 3.1. Свойства

**Параметры сети:**
- `NumRBs`, `NumUEs`, `SchedulerType` (тип алгоритма), `SymbolsPerSlot`.

**Ресурсные сетки:**
- `DL_Grid`, `UL_Grid`: трёхмерные массивы [символы × RB × UE]. Хранят «код MCS» (или 0, если блок не выделен).

**Состояние:**
- `AvgThroughput`: вектор со средней пропускной способностью (чтобы поддерживать алгоритм пропорциональной справедливости).
- `CQI_DL`, `CQI_UL`: текущее CQI для каждого UE.
- `HARQ_Processes`: структура для хранения состояний HARQ.
- `enableLogging`: флаг для вывода логов.

**ML-свойства (для CatBoost):**
- `mlEnabled`, `trainingData`, `predictionCache`.

### 3.2. Основные методы

- **Конструктор** `CustomScheduler(numRBs, numUEs, type, cqi_dl, cqi_ul)`:  
  Сохраняет входные параметры, инициализирует сетки `DL_Grid` и `UL_Grid` нулями, задаёт `AvgThroughput` и создаёт структуру HARQ-процессов.

- **Методы получения «2D-сеток»:**  
  `getDLResourceGrid` и `getULResourceGrid`, которые возвращают информацию о выделенных ресурсах для DL и UL соответственно.

- **Методы планирования:**  
  - `scheduleDL(channelInfo, t)` и `scheduleUL(channelInfo, t)` обрабатывают распределение ресурсов, в зависимости от заданного алгоритма.
  - В зависимости от `SchedulerType` вызываются соответствующие алгоритмы (RoundRobin, ProportionalFair, MaxThroughput, ML).

- **Методы для работы с ML (CatBoost):**  
  - `collectTrainingData()`: собирает данные для обучения ML.
  - `predictWithCatboost(channelInfo)`: делает предсказание с помощью обученной модели.

- **Логирование и HARQ:**  
  Выводит результаты распределения RB и обрабатывает статус связи.

## 4. Главный скрипт

После объявления классов идёт основной код, который:
1. **Задаёт параметры симуляции:** 
   - `simTime`, `numUEs`, `bandwidth`, `scs`, `tddConfig`.
  
2. **Создаёт объекты:** 
   - `SystemLevelSimulator` и `CustomScheduler`.

3. **Настраивает визуализацию:** 
   - Отображаются позиции UE и базовой станции, рисуются линии соединения.
   - Используются два графика (`imagesc`) для визуализации ресурсных сеток DL и UL.

4. **Запускает цикл по времени** `for t = 1:simTime`:
   - Определяет тип слота (DL или UL) по `tddConfig`.
   - Вызывает `updateNetwork(t)` для обновления позиций и канальных условий.
   - Вызывает соответствующий метод планировщика (`scheduleDL` или `scheduleUL`).
   - Обновляет визуализацию.

Таким образом, получается пошаговая анимация: пользователи двигаются, меняются канальные условия, а планировщик распределяет ресурсы в зависимости от выбранного алгоритма.

## 5. Примерная структура проекта (блок-схема)

![](shema.png)

**Пояснения:**
- В `SystemLevelSimulator` добавлена поддержка трафика, что позволяет более точно моделировать нагрузку на сеть.
- `CustomScheduler` теперь учитывает как параметры канала, так и трафик при выборе стратегий распределения ресурсов.

## 6. Что уже реализовано и возможное расширение

**Реализовано:**  
- Базовый системный симулятор с движением UE, расчетом канала и параметрами трафика.
- Планировщик с поддержкой классических алгоритмов планирования и простейшей интеграцией ML (CatBoost).
- Визуализация движений UE и распределения ресурсных блоков с учетом трафика.

**Возможные улучшения:**  
- Расширение канальной модели (учет затухания, многолучевости).
- Создание модуля Benchmark для сравнения алгоритмов по различным метрикам (throughput, BLER, задержка и т.д.).
- Расширение ML-модуля с дополнительными моделями и полноценным циклом обучения.
- Реализация логики обработки пакетов для улучшения управления трафиком (PDCP, RLC, MAC).

## 7. Итоговое описание

Проект представляет собой прототип системного уровня симулятора LTE/5G, который теперь включает:
- **SystemLevelSimulator**: моделирует пространство, движение пользователей, рассчитывает параметры канала и трафик.
- **CustomScheduler**: принимает данные о канале и трафике и распределяет ресурсные блоки между пользователями с использованием различных алгоритмов.
- Главный скрипт организует временной цикл, переключает TDD-слоты, обновляет условия канала и визуализирует результат.

С помощью этого кода можно экспериментировать с алгоритмами планирования, учитывать динамику трафика и расширять систему для более сложных сценариев.

## 8. Программа для предсказания с использованием CatBoost

Скрипт на Python использует модель CatBoost для данных о канале и трафике, оптимизируя распределение ресурсов. Обрабатываются следующие основные этапы:
- Чтение обучающих данных.
- Генерация случайных предсказаний, если обучающие данные отсутствуют.
- Обучение модели на основе загруженных данных.
- Генерация предсказаний на основе текущего состояния каналов.

Таким образом, проект стал более комплексным и реалистичным, предоставляя платформу для дальнейших исследований и экспериментов в области системного моделирования.